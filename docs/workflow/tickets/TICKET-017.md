---
id: TICKET-017
title: "LLM監視エージェントによるインテリジェントなidle検知"
status: backlog
assignee: ""
priority: medium
depends_on: [TICKET-016]
created_by: planner
created_at: "2026-02-25T00:00:00+09:00"
updated_at: "2026-02-25T00:00:00+09:00"
labels: [feature, idea]
estimated_complexity: L
---

# TICKET-017: LLM監視エージェントによるインテリジェントなidle検知

## Motivation

現在のidle検知は tmux ペイン出力の正規表現マッチに依存しており、脆い:

- プロンプト文字が変わると検知できない（例: `❯` の未対応）
- 「なぜ止まっているか」を判断できない
- 許可確認待ち、エラーで困っている、等の区別ができない
- ナッジメッセージが一律で、状況に応じた対応ができない

## Idea

専用の監視エージェント（Claude Code）を別ペインで常駐させ、
各エージェントの状態を LLM の文脈理解で判断する。

### 想定フロー

1. 監視エージェントが定期的に `tmux capture-pane` で各ペインの出力を取得
2. 出力を読んで「止まっているか」「なぜ止まっているか」を判断
3. 状況に応じたリカバリアクションを実行:
   - idle（入力待ち）→ タスク続行を促すナッジ
   - 許可確認待ち → `y` を入力
   - エラーで困っている → 具体的なヒントを送信
   - 正常に処理中 → 何もしない

### メリット

- 正規表現のメンテナンスが不要
- CLI のUI変更に自動追従
- 「なぜ止まっているか」に応じてアクションを変えられる
- 将来的にエージェント間の調整も担当できる可能性

### 懸念

- API コスト増（ただし5分に1回程度なら軽微）
- 監視エージェント自体が止まるリスク（誰が監視者を監視するか問題）
- 応答のばらつき（LLM の判断が毎回同じとは限らない）

## References

- TICKET-016: 現行の正規表現ベースの idle 検知実装
